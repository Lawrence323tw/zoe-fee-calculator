
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>å ´ç§Ÿè²»ç·šä¸Šè¨ˆç®—å™¨ï¼ˆå¤§å»³ï¼åŒ…å ´ï½œæ´¾å°åŒ…å ´å»ºè­°-ä¿®æ­£ç‰ˆ5ï¼‰</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root { --font-size: 16px; --radius: 10px; --gap: 12px; --control-height: 44px; }
        @media (prefers-color-scheme: dark) {
            :root { color-scheme: dark; }
            body { background: #111; color: #eee; }
            select, input, button { background: #1c1c1c; color: #eee; border-color: #333; }
        }
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; line-height: 1.6; padding: 16px; font-size: var(--font-size); -webkit-text-size-adjust: 100%; }
        .container { max-width: 760px; margin: 0 auto; }
        h2 { margin: 0 0 12px 0; font-size: 1.25rem; }
        .row { display: grid; grid-template-columns: 1fr; gap: 8px; margin: 10px 0; }
        label { display: block; font-weight: 600; }
        select, input[type="radio"], button { font-size: 1rem; }
        select { width: 100%; height: var(--control-height); border-radius: var(--radius); border: 1px solid #ccc; padding: 0 12px; }
        fieldset { border: 1px solid #ddd; border-radius: var(--radius); padding: 10px 12px; }
        legend { padding: 0 6px; font-weight: 600; }
        .radio-group { display: flex; flex-wrap: wrap; gap: 12px; }
        .radio-item { display: flex; align-items: center; gap: 6px; padding: 6px 8px; border-radius: 8px; background: #f5f5f5; }
        @media (prefers-color-scheme: dark) { .radio-item { background: #222; } }
        #calcBtn { width: 100%; height: var(--control-height); border-radius: var(--radius); border: none; background: #2f7cf2; color: white; font-size: 1.05rem; font-weight: 700; }
        #calcBtn:active { transform: scale(0.995); }
        #result { margin-top: 14px; font-weight: bold; line-height: 1.8; }
        @media (min-width: 560px) { .row { grid-template-columns: 160px 1fr; align-items: center; } label { margin: 0; } }
        .strike { text-decoration: line-through; color: #888; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <h2>å ´ç§Ÿè²»ç·šä¸Šè¨ˆç®—å™¨</h2>

        <!-- æ–¹æ¡ˆï¼šå–®é¸ -->
        <fieldset class="row">
            <legend>æ–¹æ¡ˆ</legend>
            <div class="radio-group" role="radiogroup" aria-label="æ–¹æ¡ˆ">
                <label class="radio-item">
                    <input type="radio" name="mode" value="hall" checked>
                    <span>å¤§å»³</span>
                </label>
                <label class="radio-item">
                    <input type="radio" name="mode" value="banquet">
                    <span>åŒ…å ´</span>
                </label>
            </div>
        </fieldset>

        <!-- æ˜ŸæœŸ -->
        <div class="row">
            <label for="weekdaySelect">æ˜ŸæœŸ</label>
            <select id="weekdaySelect">
                <option value="" selected disabled>è«‹é¸æ“‡</option>
                <option value="1">æ˜ŸæœŸä¸€</option>
                <option value="2">æ˜ŸæœŸäºŒ</option>
                <option value="3">æ˜ŸæœŸä¸‰</option>
                <option value="4">æ˜ŸæœŸå››</option>
                <option value="5">æ˜ŸæœŸäº”</option>
                <option value="6">æ˜ŸæœŸå…­</option>
                <option value="7">æ˜ŸæœŸæ—¥</option>
            </select>
        </div>

        <!-- äººæ•¸ï¼ˆ1~30ï¼‰ -->
        <div class="row">
            <label for="peopleSelect">äººæ•¸</label>
            <select id="peopleSelect">
                <option value="" selected disabled>è«‹é¸æ“‡</option>
                <option value="1">1äºº</option><option value="2">2äºº</option><option value="3">3äºº</option><option value="4">4äºº</option><option value="5">5äºº</option>
                <option value="6">6äºº</option><option value="7">7äºº</option><option value="8">8äºº</option><option value="9">9äºº</option><option value="10">10äºº</option>
                <option value="11">11äºº</option><option value="12">12äºº</option><option value="13">13äºº</option><option value="14">14äºº</option><option value="15">15äºº</option>
                <option value="16">16äºº</option><option value="17">17äºº</option><option value="18">18äºº</option><option value="19">19äºº</option><option value="20">20äºº</option>
                <option value="21">21äºº</option><option value="22">22äºº</option><option value="23">23äºº</option><option value="24">24äºº</option><option value="25">25äºº</option>
                <option value="26">26äºº</option><option value="27">27äºº</option><option value="28">28äºº</option><option value="29">29äºº</option><option value="30">30äºº</option>
            </select>
        </div>

        <!-- å°æ™‚ï¼ˆ3~10ï¼‰ -->
        <div class="row">
            <label for="hourSelect">å°æ™‚</label>
            <select id="hourSelect">
                <option value="" selected disabled>è«‹é¸æ“‡</option>
                <option value="3">3å°æ™‚</option><option value="4">4å°æ™‚</option><option value="5">5å°æ™‚</option>
                <option value="6">6å°æ™‚</option><option value="7">7å°æ™‚</option><option value="8">8å°æ™‚</option>
                <option value="9">9å°æ™‚</option><option value="10">10å°æ™‚</option>
            </select>
        </div>

        <button id="calcBtn">è¨ˆç®—</button>
        <div id="result" aria-live="polite"></div>
    </div>

<script>
const weekdaySelect = document.getElementById('weekdaySelect');
const peopleSelect = document.getElementById('peopleSelect');
const hourSelect = document.getElementById('hourSelect');
const calcBtn = document.getElementById('calcBtn');

peopleSelect.addEventListener('change', () => {
    const mode = document.querySelector('input[name="mode"]:checked')?.value;
    const peopleNum = normalizePeople();
    if (mode === 'hall' && peopleNum >= 6) {
        document.querySelector('input[name="mode"][value="banquet"]').checked = true;
    }
});

calcBtn.addEventListener('click', calc);

const MIN_PACKAGE_PEOPLE = 15;
const PARTY_PACKAGE_HOURS = new Set([6, 8, 10]);

function mapToPackageHour(hour) {
    if (PARTY_PACKAGE_HOURS.has(hour)) return hour;
    if (hour === 7) return 8;
    if (hour === 9) return 10;
    return null;
}
function getPartyPackagePrice(hour, holiday) {
    const weekdayPackage = { 6: 3300, 8: 4500, 10: 5500 };
    const holidayPackage = { 6: 4500, 8: 6000, 10: 7000 };
    const table = holiday ? holidayPackage : weekdayPackage;
    return table[hour] ?? null;
}

function calc() {
    const resultDiv = document.getElementById('result');
    const mode = document.querySelector('input[name="mode"]:checked')?.value;
    const weekday = normalizeWeekday();
    let people = normalizePeople();
    let hour = normalizeHour();

    if (mode === 'hall' && people >= 6) {
        document.querySelector('input[name="mode"][value="banquet"]').checked = true;
    }
    const finalMode = document.querySelector('input[name="mode"]:checked')?.value;

    if (!finalMode || weekday == null || people == null || hour == null) { resultDiv.innerHTML = "è¼¸å…¥ä¸å®Œæ•´æˆ–ä¸æ­£ç¢ºã€‚"; return; }
    if (people < 1 || people > 30) { resultDiv.innerHTML = "äººæ•¸éœ€ç‚º 1â€“30ã€‚"; return; }
    if (hour < 3 || hour > 10) { resultDiv.innerHTML = "å°æ™‚éœ€ç‚º 3â€“10ã€‚"; return; }

    const holiday = (weekday >= 6);

    if (finalMode === 'banquet') {
        const baseOriginal = getBanquetBaseTotal(people, holiday);
        if (baseOriginal == null) { resultDiv.innerHTML = "åŒ…å ´äººæ•¸è¶…éä¸Šé™ï¼ˆ30 äººï¼‰ã€‚"; return; }
        const extraRatePerPerson = holiday ? 60 : 50;
        const extraHours = Math.max(0, hour - 3);
        const extraOriginal = extraRatePerPerson * people * extraHours;
        const totalOriginal = baseOriginal + extraOriginal;

        const packageHour = mapToPackageHour(hour);
        const canApplyPackage = (people >= MIN_PACKAGE_PEOPLE) && (packageHour != null);

        const lines = [];
        const titleScheme = (people >= MIN_PACKAGE_PEOPLE) ? 'æ´¾å°åŒ…å ´' : 'åŒ…å ´';

        if (canApplyPackage) {
            const packageBase = getPartyPackagePrice(packageHour, holiday);
            const extraCount = Math.max(0, people - 15);
            const extraPeopleFee = extraCount * (holiday ? 200 : 150);
            const total = packageBase + extraPeopleFee;
            const perPerson = Number.isInteger(total/people) ? (total/people) : (total/people).toFixed(2);

            const parts = [
                `é¸æ“‡æ–¹æ¡ˆï¼šæ´¾å°åŒ…å ´`,
                `åŸåƒ¹ï¼š<span class="strike">${totalOriginal} å…ƒ</span>`,
                `å„ªæƒ åƒ¹ï¼ˆ${packageHour}Hï¼‰ï¼š${packageBase} å…ƒ`,
                (extraPeopleFee > 0 ? `äººæ•¸åŠ åƒ¹ï¼š${extraPeopleFee} å…ƒ` : ''),
                `ç¸½é‡‘é¡ï¼š${total} å…ƒ`,
                `æ¯äººé‡‘é¡ï¼š${perPerson} å…ƒ`
            ].filter(Boolean);
            resultDiv.innerHTML = parts.join('<br>');
            return;
        } else {
            const perPersonOriginal = Number.isInteger(totalOriginal/people) ? (totalOriginal/people) : (totalOriginal/people).toFixed(2);

            if (packageHour != null) {
                const packageBaseRef = getPartyPackagePrice(packageHour, holiday);
                const extraCountRef = Math.max(0, people - 15);
                const extraPeopleFeeRef = extraCountRef * (holiday ? 200 : 150);
                const packageTotalRef = packageBaseRef + extraPeopleFeeRef;

                if (packageTotalRef < totalOriginal) {
                    const save = totalOriginal - packageTotalRef;
                    const perPersonRef = Number.isInteger(packageTotalRef / people)
                        ? (packageTotalRef / people)
                        : (packageTotalRef / people).toFixed(2);

                    lines.push(`å»ºè­°æ–¹æ¡ˆï¼šæ´¾å°åŒ…å ´`);
                    lines.push(`åŸåƒ¹ï¼š<span class="strike">${totalOriginal} å…ƒ</span>`);
                    lines.push(`å„ªæƒ åƒ¹ï¼ˆ${packageHour}Hï¼‰ï¼š${packageTotalRef} å…ƒ`);
                    lines.push(`äººæ•¸ï¼š${people}äºº`);
                    lines.push(`æ¯äººé‡‘é¡ï¼š${perPersonRef} å…ƒ`);
                    lines.push(`ï¼ˆæ¯”åŸæ–¹æ¡ˆçœä¸‹ ${save} å…ƒï¼‰`);
                    lines.push('');
                }
            }

            lines.push(`åŸæ–¹æ¡ˆï¼šåŒ…å ´`);
            lines.push(`åŸºç¤è²»ï¼š${baseOriginal} å…ƒ`);
            lines.push(`åŠ æ™‚è²»ï¼š${extraOriginal} å…ƒ`);
            lines.push(`ç¸½é‡‘é¡ï¼š${totalOriginal} å…ƒ`);
            lines.push(`æ¯äººé‡‘é¡ï¼š${perPersonOriginal} å…ƒ`);

            resultDiv.innerHTML = lines.join('<br>');
            return;
        }
    }

    // å¤§å»³ï¼ˆå·²åŠ å…¥ã€ŒåŒ…å ´æ¯”è¼ƒã€å»ºè­°ï¼‰
    let peopleForRate = people;
    if (people === 5) peopleForRate = 4;
    if (people > 5) {
        document.getElementById('result').innerHTML =
            "å¤§å»³äººæ•¸åƒ…æ”¯æ´è‡³ 5 äººï¼ˆ5 äººä»¥ 4 äººè²»ç‡è¨ˆï¼‰ã€‚6 äººä»¥ä¸Šå·²è‡ªå‹•åˆ‡æ›ç‚ºåŒ…å ´ã€‚";
        return;
    }

    let basePerPerson = 0, extraPerPerson = 0;
    const holiday2 = (weekday >= 6);
    if (!holiday2) {
        if (peopleForRate === 1) { basePerPerson = 300; extraPerPerson = 70; }
        else if (peopleForRate === 2) { basePerPerson = 250; extraPerPerson = 60; }
        else if (peopleForRate === 3) { basePerPerson = 230; extraPerPerson = 50; }
        else if (peopleForRate === 4) { basePerPerson = 200; extraPerPerson = 50; }
    } else {
        if (peopleForRate === 1) { basePerPerson = 350; extraPerPerson = 100; }
        else if (peopleForRate === 2) { basePerPerson = 300; extraPerPerson = 90; }
        else if (peopleForRate === 3) { basePerPerson = 270; extraPerPerson = 80; }
        else if (peopleForRate === 4) { basePerPerson = 250; extraPerPerson = 80; }
    }
    const extraHours = Math.max(0, hour - 3);
    const base = basePerPerson * people;
    const extra = extraPerPerson * people * extraHours;
    const hallTotal = base + extra;
    const perPersonHall = Number.isInteger(hallTotal/people) ? (hallTotal/people) : (hallTotal/people).toFixed(2);

    // ğŸ”„ åŒæ­¥è©¦ç®—ã€ŒåŒ…å ´ã€ä¸¦èˆ‡å¤§å»³æ¯”è¼ƒ
    const banquetBase = getBanquetBaseTotal(people, holiday2);
    const banquetExtra = (holiday2 ? 60 : 50) * people * extraHours;
    const banquetTotal = (banquetBase != null) ? (banquetBase + banquetExtra) : null;

    if (banquetTotal != null && banquetTotal < hallTotal) {
        const save = hallTotal - banquetTotal;
        const perPersonBanquet = Number.isInteger(banquetTotal / people)
            ? (banquetTotal / people)
            : (banquetTotal / people).toFixed(2);

        const lines = [];
        lines.push(`å»ºè­°æ–¹æ¡ˆï¼šåŒ…å ´`);
        lines.push(`åŸåƒ¹ï¼š<span class="strike">${hallTotal} å…ƒ</span>`);
        lines.push(`åŒ…å ´åƒ¹ï¼ˆ${hour}Hï¼‰ï¼š${banquetTotal} å…ƒ`);
        lines.push(`äººæ•¸ï¼š${people}äºº`);
        lines.push(`æ¯äººé‡‘é¡ï¼š${perPersonBanquet} å…ƒ`);
        lines.push(`ï¼ˆæ¯”åŸæ–¹æ¡ˆçœä¸‹ ${save} å…ƒï¼‰`);
        lines.push('');

        lines.push(`åŸæ–¹æ¡ˆï¼šå¤§å»³`);
        lines.push(`åŸºç¤è²»ï¼š${base} å…ƒ`);
        lines.push(`åŠ æ™‚è²»ï¼š${extra} å…ƒ`);
        lines.push(`ç¸½é‡‘é¡ï¼š${hallTotal} å…ƒ`);
        lines.push(`æ¯äººé‡‘é¡ï¼š${perPersonHall} å…ƒ`);

        document.getElementById('result').innerHTML = lines.join('<br>');
        return;
    }

    document.getElementById('result').innerHTML = [
        `é¸æ“‡æ–¹æ¡ˆï¼šå¤§å»³`,
        `åŸºç¤è²»ï¼š${base} å…ƒ`,
        `åŠ æ™‚è²»ï¼š${extra} å…ƒ`,
        `ç¸½é‡‘é¡ï¼š${hallTotal} å…ƒ`,
        `æ¯äººé‡‘é¡ï¼š${perPersonHall} å…ƒ`
    ].join('<br>');
}

function normalizeWeekday() { const v = weekdaySelect.value; if (!v) return null; const n = Number(v); return (n >= 1 && n <= 7) ? n : null; }
function normalizePeople() { const v = peopleSelect.value; if (!v) return null; const n = Number(v); return (n >= 1 && n <= 30) ? n : null; }
function normalizeHour() { const v = hourSelect.value; if (!v) return null; const n = Number(v); return (n >= 3 && n <= 10) ? n : null; }

function getBanquetBaseTotal(people, holiday) {
    const weekdayTotal = { 1:800, 2:800, 3:800, 4:800, 5:1000, 6:1200, 7:1330, 8:1520, 9:1620, 10:1800, 11:1870, 12:2040, 13:2080, 14:2240, 15:2250 };
    const holidayTotal = { 1:1500, 2:1500, 3:1500, 4:1500, 5:1500, 6:1500, 7:1680, 8:1920, 9:2070, 10:2300, 11:2420, 12:2640, 13:2730, 14:2940, 15:3000 };
    if (people < 1 || people > 30) return null;
    if (people <= 15) return (holiday ? holidayTotal[people] : weekdayTotal[people]);
    const perPersonRate = holiday ? 200 : 150; // 16~30 äººå»¶ä¼¸
    return perPersonRate * people;
}

// é é¢è¼‰å…¥å¾Œé è¨­æ˜ŸæœŸ
document.addEventListener('DOMContentLoaded', () => {
    const day0to6 = new Date().getDay();
    const day1to7 = day0to6 === 0 ? 7 : day0to6;
    const weekdaySelect = document.getElementById('weekdaySelect');
    if (weekdaySelect) { weekdaySelect.value = String(day1to7); }
});
</script>
</body>
</html>
