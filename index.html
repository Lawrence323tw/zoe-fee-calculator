
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>場租費線上計算器（大廳／包場｜派對包場建議-修正版5）</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root { --font-size: 16px; --radius: 10px; --gap: 12px; --control-height: 44px; }
        @media (prefers-color-scheme: dark) { 
            :root { color-scheme: dark; } 
            body { background: #111; color: #eee; } 
            select, input, button { background: #1c1c1c; color: #eee; border-color: #333; } 
        }
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; line-height: 1.6; padding: 16px; font-size: var(--font-size); -webkit-text-size-adjust: 100%; }
        .container { max-width: 760px; margin: 0 auto; }
        h2 { margin: 0 0 12px 0; font-size: 1.25rem; }
        .row { display: grid; grid-template-columns: 1fr; gap: 8px; margin: 10px 0; }
        label { display: block; font-weight: 600; }
        select, input[type="radio"], button { font-size: 1rem; }
        select { width: 100%; height: var(--control-height); border-radius: var(--radius); border: 1px solid #ccc; padding: 0 12px; }
        fieldset { border: 1px solid #ddd; border-radius: var(--radius); padding: 10px 12px; }
        legend { padding: 0 6px; font-weight: 600; }
        .radio-group { display: flex; flex-wrap: wrap; gap: 12px; }
        .radio-item { display: flex; align-items: center; gap: 6px; padding: 6px 8px; border-radius: 8px; background: #f5f5f5; }
        @media (prefers-color-scheme: dark) { .radio-item { background: #222; } }
        #calcBtn { width: 100%; height: var(--control-height); border-radius: var(--radius); border: none; background: #2f7cf2; color: white; font-size: 1.05rem; font-weight: 700; }
        #calcBtn:active { transform: scale(0.995); }
        #result { margin-top: 14px; font-weight: bold; line-height: 1.8; }
        @media (min-width: 560px) { .row { grid-template-columns: 160px 1fr; align-items: center; } label { margin: 0; } }
        .strike { text-decoration: line-through; color: #888; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <h2>場租費線上計算器</h2>

        <!-- 方案：單選 -->
        <fieldset class="row">
            <legend>方案</legend>
            <div class="radio-group" role="radiogroup" aria-label="方案">
                <label class="radio-item">
                    <input type="radio" name="mode" value="hall" checked>
                    <span>大廳</span>
                </label>
                <label class="radio-item">
                    <input type="radio" name="mode" value="banquet">
                    <span>包場</span>
                </label>
            </div>
        </fieldset>

        <!-- 星期 -->
        <div class="row">
            <label for="weekdaySelect">星期</label>
            <select id="weekdaySelect">
                <option value="" selected disabled>請選擇</option>
                <option value="1">星期一</option>
                <option value="2">星期二</option>
                <option value="3">星期三</option>
                <option value="4">星期四</option>
                <option value="5">星期五</option>
                <option value="6">星期六</option>
                <option value="7">星期日</option>
            </select>
        </div>

        <!-- 人數（1~30） -->
        <div class="row">
            <label for="peopleSelect">人數</label>
            <select id="peopleSelect">
                <option value="" selected disabled>請選擇</option>
                <option value="1">1人</option><option value="2">2人</option><option value="3">3人</option><option value="4">4人</option><option value="5">5人</option>
                <option value="6">6人</option><option value="7">7人</option><option value="8">8人</option><option value="9">9人</option><option value="10">10人</option>
                <option value="11">11人</option><option value="12">12人</option><option value="13">13人</option><option value="14">14人</option><option value="15">15人</option>
                <option value="16">16人</option><option value="17">17人</option><option value="18">18人</option><option value="19">19人</option><option value="20">20人</option>
                <option value="21">21人</option><option value="22">22人</option><option value="23">23人</option><option value="24">24人</option><option value="25">25人</option>
                <option value="26">26人</option><option value="27">27人</option><option value="28">28人</option><option value="29">29人</option><option value="30">30人</option>
            </select>
        </div>

        <!-- 小時（3~10） -->
        <div class="row">
            <label for="hourSelect">小時</label>
            <select id="hourSelect">
                <option value="" selected disabled>請選擇</option>
                <option value="3">3小時</option><option value="4">4小時</option><option value="5">5小時</option>
                <option value="6">6小時</option><option value="7">7小時</option><option value="8">8小時</option>
                <option value="9">9小時</option><option value="10">10小時</option>
            </select>
        </div>

        <button id="calcBtn">計算</button>
        <div id="result" aria-live="polite"></div>
    </div>

<script>
const weekdaySelect = document.getElementById('weekdaySelect');
const peopleSelect = document.getElementById('peopleSelect');
const hourSelect = document.getElementById('hourSelect');
const calcBtn = document.getElementById('calcBtn');

peopleSelect.addEventListener('change', () => {
    const mode = document.querySelector('input[name="mode"]:checked')?.value;
    const peopleNum = normalizePeople();
    if (mode === 'hall' && peopleNum >= 6) {
        document.querySelector('input[name="mode"][value="banquet"]').checked = true;
    }
});

calcBtn.addEventListener('click', calc);

const MIN_PACKAGE_PEOPLE = 15;
const PARTY_PACKAGE_HOURS = new Set([6, 8, 10]);

function mapToPackageHour(hour) {
    if (PARTY_PACKAGE_HOURS.has(hour)) return hour;
    if (hour === 7) return 8;
    if (hour === 9) return 10;
    return null;
}
function getPartyPackagePrice(hour, holiday) {
    const weekdayPackage = { 6: 3300, 8: 4500, 10: 5500 };
    const holidayPackage = { 6: 4500, 8: 6000, 10: 7000 };
    const table = holiday ? holidayPackage : weekdayPackage;
    return table[hour] ?? null;
}

function calc() {
    const resultDiv = document.getElementById('result');
    const mode = document.querySelector('input[name="mode"]:checked')?.value;
    const weekday = normalizeWeekday();
    let people = normalizePeople();
    let hour = normalizeHour();

    if (mode === 'hall' && people >= 6) {
        document.querySelector('input[name="mode"][value="banquet"]').checked = true;
    }
    const finalMode = document.querySelector('input[name="mode"]:checked')?.value;

    if (!finalMode || weekday == null || people == null || hour == null) { resultDiv.innerHTML = "輸入不完整或不正確。"; return; }
    if (people < 1 || people > 30) { resultDiv.innerHTML = "人數需為 1–30。"; return; }
    if (hour < 3 || hour > 10) { resultDiv.innerHTML = "小時需為 3–10。"; return; }

    const holiday = (weekday >= 6);

    if (finalMode === 'banquet') {
        const baseOriginal = getBanquetBaseTotal(people, holiday);
        if (baseOriginal == null) { resultDiv.innerHTML = "包場人數超過上限（30 人）。"; return; }
        const extraRatePerPerson = holiday ? 60 : 50;
        const extraHours = Math.max(0, hour - 3);
        const extraOriginal = extraRatePerPerson * people * extraHours;
        const totalOriginal = baseOriginal + extraOriginal;

        const packageHour = mapToPackageHour(hour);
        const canApplyPackage = (people >= MIN_PACKAGE_PEOPLE) && (packageHour != null);

        const lines = [];
        const titleScheme = (people >= MIN_PACKAGE_PEOPLE) ? '派對包場' : '包場';
        // 不管是否可套用派對包場，這裡的顯示都控制在 else 分支（不可直接套用）先顯示建議，再顯示原方案

        if (canApplyPackage) {
            // 可直接套用派對包場：仍採分行（原價 / 優惠價）格式
            const packageBase = getPartyPackagePrice(packageHour, holiday);
            const extraCount = Math.max(0, people - 15);
            const extraPeopleFee = extraCount * (holiday ? 200 : 150);
            const total = packageBase + extraPeopleFee;
            const perPerson = Number.isInteger(total/people) ? (total/people) : (total/people).toFixed(2);

            // 這裡顯示「選擇方案：派對包場」的最終價格（因為已適用派對包場）
            const parts = [
                `選擇方案：派對包場`,
                `原價：<span class="strike">${totalOriginal} 元</span>`,
                `優惠價（${packageHour}H）：${packageBase} 元`,
                (extraPeopleFee > 0 ? `人數加價：${extraPeopleFee} 元` : ''),
                `總金額：${total} 元`,
                `每人金額：${perPerson} 元`
            ].filter(Boolean);
            resultDiv.innerHTML = parts.join('<br>');
            return;
        } else {
            // 不可直接套用派對包場：先顯示建議方案，再顯示原方案（你指定的順序與換行）
            // 原方案（包場）計算
            const perPersonOriginal = Number.isInteger(totalOriginal/people) ? (totalOriginal/people) : (totalOriginal/people).toFixed(2);

            // 建議方案試算（若更便宜就顯示）
            if (packageHour != null) {
                const packageBaseRef = getPartyPackagePrice(packageHour, holiday);
                const extraCountRef = Math.max(0, people - 15);
                const extraPeopleFeeRef = extraCountRef * (holiday ? 200 : 150);
                const packageTotalRef = packageBaseRef + extraPeopleFeeRef;

                if (packageTotalRef < totalOriginal) {
                    const save = totalOriginal - packageTotalRef;
                    const perPersonRef = Number.isInteger(packageTotalRef / people)
                        ? (packageTotalRef / people)
                        : (packageTotalRef / people).toFixed(2);

                    // ✅ 先顯示建議方案：第一行只顯示「建議方案：派對包場」，第二行開始分行
                    lines.push(`建議方案：派對包場`);
                    lines.push(`原價：<span class="strike">${totalOriginal} 元</span>`);
                    lines.push(`優惠價（${packageHour}H）：${packageTotalRef} 元`);
                    lines.push(`人數：${people}人`);
                    lines.push(`每人金額：${perPersonRef} 元`);
                    lines.push(`（比原方案省下 ${save} 元）`);
                    lines.push(''); // 空行分隔
                }
            }

            // ✅ 再顯示原方案：包場
            lines.push(`選擇方案：包場`);
            lines.push(`基礎費：${baseOriginal} 元`);
            lines.push(`加時費：${extraOriginal} 元`);
            lines.push(`總金額：${totalOriginal} 元`);
            lines.push(`每人金額：${perPersonOriginal} 元`);

            resultDiv.innerHTML = lines.join('<br>');
            return;
        }
    }

    // 大廳
    let peopleForRate = people;
    if (people === 5) peopleForRate = 4;
    if (people > 5) { document.getElementById('result').innerHTML = "大廳人數僅支援至 5 人（5 人以 4 人費率計）。6 人以上已自動切換為包場。"; return; }

    let basePerPerson = 0, extraPerPerson = 0;
    const holiday2 = (weekday >= 6);
    if (!holiday2) {
        if (peopleForRate === 1) { basePerPerson = 300; extraPerPerson = 70; }
        else if (peopleForRate === 2) { basePerPerson = 250; extraPerPerson = 60; }
        else if (peopleForRate === 3) { basePerPerson = 230; extraPerPerson = 50; }
        else if (peopleForRate === 4) { basePerPerson = 200; extraPerPerson = 50; }
    } else {
        if (peopleForRate === 1) { basePerPerson = 350; extraPerPerson = 100; }
        else if (peopleForRate === 2) { basePerPerson = 300; extraPerPerson = 90; }
        else if (peopleForRate === 3) { basePerPerson = 270; extraPerPerson = 80; }
        else if (peopleForRate === 4) { basePerPerson = 250; extraPerPerson = 80; }
    }
    const extraHours = Math.max(0, hour - 3);
    const base = basePerPerson * people;
    const extra = extraPerPerson * people * extraHours;
    const total = base + extra;
    const perPerson = Number.isInteger(total/people) ? (total/people) : (total/people).toFixed(2);
    document.getElementById('result').innerHTML = [
        `選擇方案：大廳`,
        `基礎費：${base} 元`,
        `加時費：${extra} 元`,
        `總金額：${total} 元`,
        `每人金額：${perPerson} 元`
    ].join('<br>');
}

function normalizeWeekday() { const v = weekdaySelect.value; if (!v) return null; const n = Number(v); return (n >= 1 && n <= 7) ? n : null; }
function normalizePeople() { const v = peopleSelect.value; if (!v) return null; const n = Number(v); return (n >= 1 && n <= 30) ? n : null; }
function normalizeHour() { const v = hourSelect.value; if (!v) return null; const n = Number(v); return (n >= 3 && n <= 10) ? n : null; }

function getBanquetBaseTotal(people, holiday) {
    const weekdayTotal = { 1:800, 2:800, 3:800, 4:800, 5:1000, 6:1200, 7:1330, 8:1520, 9:1620, 10:1800, 11:1870, 12:2040, 13:2080, 14:2240, 15:2250 };
    const holidayTotal = { 1:1500, 2:1500, 3:1500, 4:1500, 5:1500, 6:1500, 7:1680, 8:1920, 9:2070, 10:2300, 11:2420, 12:2640, 13:2730, 14:2940, 15:3000 };
    if (people < 1 || people > 30) return null;
    if (people <= 15) return (holiday ? holidayTotal[people] : weekdayTotal[people]);
    const perPersonRate = holiday ? 200 : 150; // 16~30 人延伸
    return perPersonRate * people;
}

// 頁面載入後預設星期
document.addEventListener('DOMContentLoaded', () => {
    const day0to6 = new Date().getDay();
    const day1to7 = day0to6 === 0 ? 7 : day0to6;
    const weekdaySelect = document.getElementById('weekdaySelect');
    if (weekdaySelect) { weekdaySelect.value = String(day1to7); }
});
</script>
</body>
</html>
